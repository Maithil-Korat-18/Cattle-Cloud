<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finances - Cattle-Cloud</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/expenses.css') }}">
</head>
<body>
<div class="app-container">
    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <span class="material-symbols-outlined">grass</span>
            </div>
            <span class="sidebar-brand">Cattle-Cloud</span>
        </div>
        <nav class="sidebar-nav">
            <a href="/dashboard" class="nav-item">
                <span class="material-symbols-outlined nav-icon">dashboard</span>
                <span class="nav-text">Dashboard</span>
            </a>
            <a href="/cattle" class="nav-item">
                <span class="material-symbols-outlined nav-icon">pets</span>
                <span class="nav-text">Cattle Herd</span>
            </a>
            <a href="/milk" class="nav-item">
                <span class="material-symbols-outlined nav-icon">water_drop</span>
                <span class="nav-text">Production</span>
            </a>
            <a href="/feed" class="nav-item">
                <span class="material-symbols-outlined nav-icon">grass</span>
                <span class="nav-text">Feed</span>
            </a>
            <a href="/expenses" class="nav-item active">
                <span class="material-symbols-outlined nav-icon filled">account_balance_wallet</span>
                <span class="nav-text">Finances</span>
            </a>
        </nav>
        <div class="sidebar-footer">
            <a href="#" class="nav-item">
                <span class="material-symbols-outlined nav-icon">settings</span>
                <span class="nav-text">Settings</span>
            </a>
            <div class="user-profile">
                <img src="https://lh3.googleusercontent.com/aida-public/AB6AXuCPWkZjCgogEUATrDJQIusbvxGyyx9IIGNYh6W3Lew2sXZRXu816fbskZ54TpweLa5WI506LnIN_9M8ydY64TJYotY_5431t-o7tNNOWZABq2w3LAJWPUaj3sE6y_VGqTflnHAO9i5P92IKXzuBjI6YAYlLnqWAmrVe7Jhe1B-X3sjUpaAN4l3Z5UXjtVozMfEmXwxkr06CcoLzhZrGw9bUjycVZrA6tcUrG1m3cJmy1lGwQmLho5oL_d04sCZsmeFwSXTlt8TirpI"
                     alt="Profile" class="profile-img">
                <div class="profile-info">
                    <p class="profile-name">{{ session.get('user_name', 'User') }}</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main-content">
        <!-- Page Header -->
        <div class="page-header">
            <div>
                <h1 class="page-title">Financial Overview</h1>
                <p class="page-subtitle">Track revenue, expenses, and profitability</p>
            </div>
            <div class="header-actions">
                <!-- Date Range Selector -->
                <div class="date-filter">
                    <div>
                        <label>From Date</label>
                        <input type="date" id="rangeFrom">
                    </div>
                    <div>
                        <label>To Date</label>
                        <input type="date" id="rangeTo">
                    </div>
                    <button id="applyRangeBtn">Apply Filter</button>
                </div>
                <button class="btn btn-report" id="generateReportBtn">
                    <span class="material-symbols-outlined">description</span>
                    Generate Report
                </button>
                <button class="btn btn-primary" id="addExpenseBtn">
                    <span class="material-symbols-outlined">add</span>
                    Add Expense
                </button>
            </div>
        </div>

        <!-- Metrics Grid -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-icon revenue">
                    <span class="material-symbols-outlined">trending_up</span>
                </div>
                <div class="metric-content">
                    <p class="metric-label">Total Revenue</p>
                    <h3 class="metric-value" id="totalRevenue">₹0</h3>
                    <p class="metric-change positive">
                        <span class="material-symbols-outlined">arrow_upward</span>
                        <span id="revenueChange">This month</span>
                    </p>
                </div>
            </div>
            <div class="metric-card">
                <div class="metric-icon expenses">
                    <span class="material-symbols-outlined">payments</span>
                </div>
                <div class="metric-content">
                    <p class="metric-label">Total Expenses</p>
                    <h3 class="metric-value" id="totalExpenses">₹0</h3>
                    <p class="metric-change negative">
                        <span class="material-symbols-outlined">arrow_downward</span>
                        <span id="expensesChange">This month</span>
                    </p>
                </div>
            </div>
            <div class="metric-card">
                <div class="metric-icon profit">
                    <span class="material-symbols-outlined">account_balance</span>
                </div>
                <div class="metric-content">
                    <p class="metric-label">Net Profit</p>
                    <h3 class="metric-value" id="netProfit">₹0</h3>
                    <p class="metric-change" id="profitChange">
                        <span class="material-symbols-outlined">remove</span>
                        <span>This month</span>
                    </p>
                </div>
            </div>
            <div class="metric-card">
                <div class="metric-icon pending">
                    <span class="material-symbols-outlined">schedule</span>
                </div>
                <div class="metric-content">
                    <p class="metric-label">Pending Invoices</p>
                    <h3 class="metric-value" id="pendingInvoices">0</h3>
                    <p class="metric-change neutral">
                        <span>Requires attention</span>
                    </p>
                </div>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="charts-grid">
            <!-- Cash Flow Chart -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">Cash Flow <span id="cashFlowPeriodLabel" class="period-label"></span></h3>
                    <div class="chart-legend">
                        <span class="legend-item"><span class="legend-dot revenue"></span>Revenue</span>
                        <span class="legend-item"><span class="legend-dot expenses"></span>Expenses</span>
                    </div>
                </div>
                <div class="chart-container" style="position:relative;">
                    <canvas id="cashFlowChart" height="280"></canvas>
                </div>
            </div>

            <!-- Pie Chart: Revenue vs Expenses -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">Money Breakdown <span id="piePeriodLabel" class="period-label"></span></h3>
                </div>
                <div class="chart-container pie-container">
                    <div class="pie-chart-wrapper">
                        <canvas id="revenueDonut"></canvas>
                    </div>
                    <div id="donutLegend" class="pie-legend"></div>
                </div>
            </div>
        </div>

        <!-- Transactions Table -->
        <div class="table-card">
            <div class="table-header">
                <h3 class="table-title">Recent Transactions</h3>
                <div class="table-filters">
                    <select class="filter-select" id="filterType">
                        <option value="all">All Types</option>
                        <option value="income">Income</option>
                        <option value="expense">Expense</option>
                    </select>
                </div>
            </div>
            <div class="table-container">
                <table class="transactions-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Description</th>
                            <th>Category</th>
                            <th>Amount</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="transactionsTableBody">
                        <tr><td colspan="6" class="loading-cell">Loading transactions...</td></tr>
                    </tbody>
                </table>
            </div>
            <!-- Pagination -->
            <div class="pagination-bar" id="paginationBar">
                <span class="pagination-info" id="paginationInfo"></span>
                <div class="pagination-controls" id="paginationControls"></div>
            </div>
        </div>
    </main>
</div>

<!-- ═══════════════════════════════════════
     MODAL: Add Expense
════════════════════════════════════════ -->
<div class="modal" id="addExpenseModal">
    <div class="modal-overlay"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Add Expense</h3>
            <button class="modal-close" id="closeModal">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
        <form id="expenseForm">
            <div class="form-group">
                <label for="expenseDate">Date</label>
                <input type="date" id="expenseDate" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="expenseCategory">Category</label>
                <select id="expenseCategory" class="form-control" required>
                    <option value="">Select category</option>
                    <option value="Feed">Feed</option>
                    <option value="Veterinary">Veterinary</option>
                    <option value="Labor">Labor</option>
                    <option value="Equipment">Equipment</option>
                    <option value="Utilities">Utilities</option>
                    <option value="Maintenance">Maintenance</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label for="expenseDescription">Description</label>
                <input type="text" id="expenseDescription" class="form-control" placeholder="Enter description" required>
            </div>
            <div class="form-group">
                <label for="expenseAmount">Amount (₹)</label>
                <input type="number" id="expenseAmount" class="form-control" placeholder="0.00" step="0.01" required>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="cancelBtn">Cancel</button>
                <button type="submit" class="btn btn-primary">Add Expense</button>
            </div>
        </form>
    </div>
</div>

<!-- ═══════════════════════════════════════
     MODAL: Generate Report
════════════════════════════════════════ -->
<div class="modal" id="reportModal">
    <div class="modal-overlay"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Generate Report</h3>
            <button class="modal-close" id="closeReportModal">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
        <div class="report-form">
            <p class="report-subtitle">Choose the date range and data type for your PDF report.</p>

            <div class="form-row">
                <div class="form-group">
                    <label for="reportFrom">From Date</label>
                    <input type="date" id="reportFrom" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="reportTo">To Date</label>
                    <input type="date" id="reportTo" class="form-control" required>
                </div>
            </div>

            <div class="form-group">
                <label>Data Type</label>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="reportType" value="all" checked>
                        <span class="radio-box">
                            <span class="material-symbols-outlined">swap_vert</span>
                            All Transactions
                        </span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="reportType" value="income">
                        <span class="radio-box">
                            <span class="material-symbols-outlined">trending_up</span>
                            Income Only
                        </span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="reportType" value="expense">
                        <span class="radio-box">
                            <span class="material-symbols-outlined">payments</span>
                            Expenses Only
                        </span>
                    </label>
                </div>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="cancelReportBtn">Cancel</button>
                <button type="button" class="btn btn-report" id="downloadPdfBtn">
                    <span class="material-symbols-outlined">picture_as_pdf</span>
                    Download PDF
                </button>
            </div>
        </div>
    </div>
</div>

<!-- jsPDF CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
<!-- Chart.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>

<script src="{{ url_for('static', filename='js/expenses.js') }}"></script>
</body>
</html>