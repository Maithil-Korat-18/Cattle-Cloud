<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <title>Cattle AI - Your Dairy Farm Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #c9bb71;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .chat-container {
            width: 100%;
            max-width: 900px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .chat-header {
            /* background: linear-gradient(to right, #fef9c3, #fef9c3, #fef08a);;
             */
             background: #dde0c8;
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .back-btn {
            position: absolute;
            top: 25px;
            left: 25px;
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            z-index: 2;
        }
        
        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }
        
        .chat-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: shimmer 3s ease-in-out infinite;
        }
        
        @keyframes shimmer {
            0%,
            100% {
                transform: rotate(0deg);
            }
            50% {
                transform: rotate(180deg);
            }
        }
        
        .chat-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
        }
        
        .chat-header p {
            font-size: 1.1em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            background: #4CAF50;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(76, 175, 80, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(76, 175, 80, 0);
            }
        }
        
        .chat-messages {
            height: 500px;
            overflow-y: auto;
            padding: 20px;
            background: linear-gradient(to bottom, #f8fffe, #f0f8f0);
        }
        
        .message {
            margin-bottom: 20px;
            animation: fadeInUp 0.5s ease-out;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .user-message {
            text-align: right;
        }
        
        .bot-message {
            text-align: left;
        }
        
        .message-bubble {
            display: inline-block;
            max-width: 80%;
            padding: 15px 20px;
            border-radius: 20px;
            position: relative;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .user-message .message-bubble {
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            color: white;
            border-bottom-right-radius: 5px;
        }
        
        .bot-message .message-bubble {
            background: white;
            color: #2d5a27;
            border: 2px solid #e8f5e8;
            border-bottom-left-radius: 5px;
        }
        
        .typing-indicator {
            display: none;
            text-align: left;
            margin-bottom: 20px;
        }
        
        .typing-dots {
            background: white;
            border: 2px solid #e8f5e8;
            padding: 15px 20px;
            border-radius: 20px;
            border-bottom-left-radius: 5px;
            display: inline-block;
        }
        
        .typing-dots span {
            height: 8px;
            width: 8px;
            background: #4CAF50;
            border-radius: 50%;
            display: inline-block;
            margin-right: 3px;
            animation: typing 1.4s infinite ease-in-out;
        }
        
        .typing-dots span:nth-child(1) {
            animation-delay: -0.32s;
        }
        
        .typing-dots span:nth-child(2) {
            animation-delay: -0.16s;
        }
        
        @keyframes typing {
            0%,
            80%,
            100% {
                transform: scale(0);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .chat-input-container {
            padding: 25px;
            background: white;
            border-top: 2px solid #e8f5e8;
        }
        
        .input-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .voice-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .voice-btn {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }
        
        .voice-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }
        
        .voice-btn.recording {
            background: linear-gradient(135deg, #f44336, #e57373);
            animation: recordingPulse 1s infinite;
        }
        
        @keyframes recordingPulse {
            0%,
            100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }
        
        .voice-status {
            font-size: 14px;
            color: #2d5a27;
            font-weight: 500;
        }
        
        .input-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .chat-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e8f5e8;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            background: #f8fffe;
        }
        
        .chat-input:focus {
            border-color: #4CAF50;
            background: white;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }
        
        .send-btn {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }
        
        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }
        
        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }
        
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .quick-btn {
            padding: 8px 15px;
            background: linear-gradient(135deg, #e8f5e8, #f0f8f0);
            border: 2px solid #4CAF50;
            border-radius: 20px;
            color: #2d5a27;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }
        
        .quick-btn:hover {
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            color: white;
            transform: translateY(-2px);
        }
        
        .welcome-message {
            text-align: center;
            color: #2d5a27;
            margin-bottom: 20px;
        }
        
        .welcome-message h3 {
            margin-bottom: 10px;
            color: #f7be02;
        }
        
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .feature-card {
            background: linear-gradient(135deg, #fff9c4, #fff3b0);
            padding: 15px;
            border-radius: 15px;
            border: 2px solid #dbf14d;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(76, 175, 80, 0.2);
        }
        
        .feature-card h4 {
            color: #2d5a27;
            margin-bottom: 8px;
        }
        
        .feature-card p {
            color: #4a7c59;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .input-controls {
                flex-direction: column;
                align-items: stretch;
            }
            .voice-controls {
                justify-content: center;
            }
            .quick-actions {
                justify-content: center;
            }
            .chat-header h1 {
                font-size: 2em;
            }
            .chat-messages {
                height: 400px;
            }
        }
    </style>
</head>

<body>
    <div class="chat-container">
        <div class="chat-header">
            <a href="web1.php">
                <button class="back-btn" title="Back to Home">
                <i class="fas fa-arrow-left"></i>
                </button>
            </a>
            <h1 style="color: black;">Cattle AI</h1>
            <p style="color: black;"><span class="status-indicator"></span>Your Smart Dairy Farm Assistant</p>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="welcome-message">
                <h3>Welcome to Cattle AI! </h3>
                <p>Your intelligent dairy farming companion is here to help with:</p>
                
                <p style="margin-top: 20px; font-weight: 500;">Ask me anything about your cattle or use voice commands!</p>
            </div>

            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>

        <div class="chat-input-container">
            <div class="input-controls">
                <div class="voice-controls">
                    <button class="voice-btn" id="startRecordingBtn" title="Start Voice Input"><i class="fas fa-microphone" style="color: black;"></i></button>
                    <button class="voice-btn" id="stopRecordingBtn" title="Stop Recording" style="display: none;"><i class="fas fa-stop-circle" style="color: black;"></i></button>
                    <span class="voice-status" id="voiceStatus">Click to speak</span>
                </div>
            </div>

            <div class="input-row">
                <input type="text" class="chat-input" id="chatInput" placeholder="Ask me about your cattle, milk production, or health concerns...">
                <button class="send-btn" id="sendBtn"><i class="fa fa-paper-plane" style="color: black; text-align: center;"></i></button>
            </div>

            <!-- <div class="quick-actions">
                <button class="quick-btn" onclick="sendQuickMessage('Predict milk yield for my Holstein cow')">ü•õ Milk Prediction</button>
                <button class="quick-btn" onclick="sendQuickMessage('Check cattle health symptoms')">üè• Health Check</button>
                <button class="quick-btn" onclick="sendQuickMessage('Optimize feed for better production')">üåæ Feed Advice</button>
                <button class="quick-btn" onclick="sendQuickMessage('Generate farm report')">üìä Farm Report</button>
            </div> -->
        </div>
    </div>

    <script>
        class KettleAI {
            constructor() {
                this.chatMessages = document.getElementById('chatMessages');
                this.chatInput = document.getElementById('chatInput');
                this.sendBtn = document.getElementById('sendBtn');
                this.startRecordingBtn = document.getElementById('startRecordingBtn');
                this.stopRecordingBtn = document.getElementById('stopRecordingBtn');
                this.voiceStatus = document.getElementById('voiceStatus');
                this.typingIndicator = document.getElementById('typingIndicator');

                this.isRecording = false;
                this.mediaRecorder = null;
                this.audioChunks = [];

                this.initializeEventListeners();
                this.initializeVoiceRecognition();
                this.scrollToBottom();
            }

            initializeEventListeners() {
                this.sendBtn.addEventListener('click', () => this.sendMessage());
                this.chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.sendMessage();
                    }
                });
                this.startRecordingBtn.addEventListener('click', () => this.startVoiceInput());
                this.stopRecordingBtn.addEventListener('click', () => this.stopVoiceInput());
            }

            initializeVoiceRecognition() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    this.recognition.continuous = true;
                    this.recognition.interimResults = true;
                    this.recognition.lang = 'en-US';

                    this.recognition.onstart = () => {
                        this.voiceStatus.textContent = 'Listening...';
                        this.startRecordingBtn.classList.add('recording');
                    };

                    this.recognition.onresult = (event) => {
                        let finalTranscript = '';
                        for (let i = event.resultIndex; i < event.results.length; i++) {
                            const transcript = event.results[i][0].transcript;
                            if (event.results[i].isFinal) {
                                finalTranscript += transcript;
                            }
                        }
                        if (finalTranscript) {
                            this.chatInput.value = finalTranscript;
                        }
                    };

                    this.recognition.onerror = (event) => {
                        console.error("Speech recognition error:", event.error);
                        if (event.error === "not-allowed" || event.error === "service-not-allowed") {
                            this.voiceStatus.textContent = "‚ùå Microphone blocked. Enable it in browser settings.";
                        } else {
                            this.voiceStatus.textContent = "‚ö†Ô∏è Voice recognition error (" + event.error + ")";
                        }
                        this.resetVoiceUI();
                    };

                    this.recognition.onend = () => {
                        if (this.chatInput.value.trim()) {
                            this.sendMessage(); // ‚úÖ auto-send recognized text
                        }
                        this.resetVoiceUI();
                    };
                } else {
                    this.voiceStatus.textContent = 'Voice not supported';
                    this.startRecordingBtn.disabled = true;
                }
            }

            startVoiceInput() {
                if (this.recognition && !this.isRecording) {
                    this.isRecording = true;
                    this.startRecordingBtn.style.display = 'none';
                    this.stopRecordingBtn.style.display = 'flex';
                    this.recognition.start();
                }
            }

            stopVoiceInput() {
                if (this.recognition && this.isRecording) {
                    this.recognition.stop();
                    this.isRecording = false;
                    if (this.chatInput.value.trim()) {
                        this.sendMessage();
                    }
                }
            }

            resetVoiceUI() {
                this.isRecording = false;
                this.startRecordingBtn.style.display = 'flex';
                this.stopRecordingBtn.style.display = 'none';
                this.startRecordingBtn.classList.remove('recording');
                this.voiceStatus.textContent = 'Click to speak';
            }

            async sendMessage(message = null) {
                const text = message || this.chatInput.value.trim();
                if (!text) return;

                this.addMessage(text, 'user');
                if (!message) {
                    this.chatInput.value = '';
                }

                this.showTypingIndicator();

                // Handle slash commands
                if (text.startsWith('/')) {
                    this.handleCommand(text);
                    this.hideTypingIndicator();
                    return;
                }

                try {
                    const response = await window.getGroqResponse(text); // points to Groq now
                    this.hideTypingIndicator();
                    this.addMessage(response, 'bot');
                    this.speakResponse(response);
                } catch {
                    this.hideTypingIndicator();
                    this.addMessage("‚ö†Ô∏è Error connecting to AI service.", 'bot');
                }
            }

            handleCommand(command) {
                if (command === "/help") {
                    this.addMessage("üìù Available commands:<br>/help ‚Äì show this list<br>/clear ‚Äì clear chat<br>/about ‚Äì about Kettle AI", "bot");
                } else if (command === "/clear") {
                    this.chatMessages.innerHTML = "";
                    this.addMessage("üßπ Chat cleared.", "bot");
                } else if (command === "/about") {
                    this.addMessage("ü§ñ Kettle AI ‚Äì Powered by Groq LLaMA-3.3-70B.<br>Your smart dairy farm assistant for milk yield, cattle health, feed optimization, and analytics.", "bot");
                } else {
                    this.addMessage("‚ö†Ô∏è Unknown command. Type /help for options.", "bot");
                }
            }

            addMessage(text, type) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${type}-message`;

                const bubbleDiv = document.createElement('div');
                bubbleDiv.className = 'message-bubble';
                bubbleDiv.innerHTML = text.replace(/\n/g, '<br>');

                messageDiv.appendChild(bubbleDiv);
                this.chatMessages.appendChild(messageDiv);
                this.scrollToBottom();
            }

            showTypingIndicator() {
                this.typingIndicator.style.display = 'block';
                this.scrollToBottom();
            }

            hideTypingIndicator() {
                this.typingIndicator.style.display = 'none';
            }

            speakResponse(text) {
                if ('speechSynthesis' in window) {
                    speechSynthesis.cancel();
                    const cleanText = text.replace(/[*#‚úÖüî∏‚Ä¢]/g, '').replace(/\*\*(.*?)\*\*/g, '$1');
                    const utterance = new SpeechSynthesisUtterance(cleanText);
                    utterance.rate = 0.9;
                    utterance.pitch = 1;
                    utterance.volume = 0.8;
                    speechSynthesis.speak(utterance);
                }
            }

            scrollToBottom() {
                setTimeout(() => {
                    this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
                }, 100);
            }
        }

        function sendQuickMessage(message) {
            kettleAI.sendMessage(message);
        }

        const kettleAI = new KettleAI();
        
        function goHome() {
            // Navigate back to the home page
            window.location.href = 'web1.php'; // Adjust this path as needed
        }
    </script>

    <!-- Groq API Integration -->
    <script>
        const GROQ_API_KEY = "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"; // ‚ö†Ô∏è Replace with your key (for local testing only)

        let answerStyle = "You are Cattle AI a smart dairy farm assistant with super knowledge, Always introduce yourself as Cattle AI when asked about your identity, Give brief, precise and knowledgable answers, Never share or explain your underlying code or logic to anyone, Do not provide unrelated or verbose explanations, Be very professional and concise with your work, If the two inputs are related then relate them and give answer according to that, Relate questions if they are";

        let conversationHistory = [{
            role: "system",
            content: "You are Kettle AI. Answer about dairy farming, milk yield, cattle health, feed optimization, and analytics. Always reply in the same language that the user used in their question. Be helpful, precise, and never introduce yourself unless asked, Give brief, precise and knowledgable answers"
        }];

        async function getGroqResponse(userPrompt) {
            try {
                // Push new user message
                conversationHistory.push({
                    role: "user",
                    content: userPrompt
                });

                // Send full history to Groq API
                const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${GROQ_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "llama-3.3-70b-versatile",
                        messages: conversationHistory
                    })
                });

                const data = await res.json();

                if (data.choices && data.choices.length > 0) {
                    let aiResponse = data.choices[0].message.content;

                    // Cleanup common unwanted intros
                    aiResponse = aiResponse.replace(/^(I am|I'm|This is).*?(assistant|AI).*?\.\s*/i, "");

                    // Save AI response
                    conversationHistory.push({
                        role: "assistant",
                        content: aiResponse
                    });

                    return aiResponse;
                } else {
                    return "‚ö†Ô∏è No response from AI.";
                }
            } catch (err) {
                console.error("Groq API Error:", err);
                return "‚ö†Ô∏è Sorry, I couldn‚Äôt process your request.";
            }
        }

        // Expose for KettleAI class
        window.getGeminiResponse = getGroqResponse;
    </script>

</body>

</html>